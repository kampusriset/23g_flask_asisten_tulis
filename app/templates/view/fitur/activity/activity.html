{% extends "base/layout.html" %}
{% block content %}

<div class="max-w-6xl mx-auto">

    <h1 class="text-xl font-semibold text-gray-800 mb-6">Activity</h1>

    <!-- FILTER -->
    <form method="get" class="flex gap-3 mb-4">
        <select name="type" class="px-3 py-2 rounded bg-zinc-800 text-white">
            <option value="all" {% if activity_type=='all' %}selected{% endif %}>Semua</option>
            <option value="note" {% if activity_type=='note' %}selected{% endif %}>Catatan</option>
            <option value="rapat" {% if activity_type=='rapat' %}selected{% endif %}>Rapat</option>
        </select>

        <input type="text" name="q" placeholder="Cari judul / topik" value="{{ q }}"
            class="px-3 py-2 rounded bg-zinc-800 text-white">

        <input type="date" name="start_date" value="{{ start_date }}" class="px-3 py-2 rounded bg-zinc-800 text-white">
        <input type="date" name="end_date" value="{{ end_date }}" class="px-3 py-2 rounded bg-zinc-800 text-white">

    </form>







    <!-- EXPORT -->
    <div class="flex gap-3 mb-4">
        <a href="{{ url_for('activity_bp.export_excel', start_date=start_date, end_date=end_date, type=activity_type) }}"
            class="bg-emerald-600 text-white px-4 py-2 rounded text-sm">
            Export Excel
        </a>
        <a href="{{ url_for('activity_bp.export_activity_pdf', start_date=start_date, end_date=end_date, type=activity_type) }}"
            class="px-3 py-2 bg-red-600 text-white rounded hover:bg-red-700 text-sm">
            Export PDF
        </a>
    </div>

    <!-- PAGINATION -->
    <div class="flex justify-center gap-2 mb-6">
        {% for p in range(1, total_pages + 1) %}
        <a href="?page={{ p }}&q={{ q }}&start_date={{ start_date }}&end_date={{ end_date }}&type={{ activity_type }}"
            class="px-3 py-1 rounded {% if p == page %}bg-indigo-600 text-white{% else %}bg-zinc-800 text-gray-300{% endif %}">
            {{ p }}
        </a>
        {% endfor %}
    </div>

    <!-- TABLE -->
    <div class="overflow-x-auto bg-white rounded-xl shadow" id="activityTable">
        <table class="w-full text-sm">
            <thead class="bg-gray-100 text-gray-600">
                <tr>
                    <th class="p-3 text-left">Tipe</th>
                    <th class="p-3 text-left">Judul</th>
                    <th class="p-3 text-left">Tanggal</th>
                    <th class="p-3 text-left">Aksi</th>
                </tr>
            </thead>
            <tbody>
                {% for a in activities %}
                <tr class="border-t">
                    <td class="p-3">{{ a.type }}</td>
                    <td class="p-3">{{ a.title }}</td>
                    <td class="p-3">{{ a.date.strftime('%d %b %Y') }}</td>
                    <td class="p-3">
                        {% if a.type == "Catatan" %}
                        <a href="{{ url_for('activity_bp.export_note_pdf', id=a.id) }}" class="text-blue-600">PDF</a>
                        {% else %}
                        <a href="{{ url_for('activity_bp.export_rapat_pdf', id=a.id) }}" class="text-blue-600">PDF</a>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>


</div>

<script>
    const form = document.querySelector("form");
    let typingTimer;
    const typingDelay = 500; // 500ms setelah terakhir ketik

    function updateFilter() {
        const type = form.querySelector("select[name='type']").value;
        const q = form.querySelector("input[name='q']").value;
        const start = form.querySelector("input[name='start_date']").value;
        const end = form.querySelector("input[name='end_date']").value;

        const params = new URLSearchParams();
        if (type) params.set("type", type);
        if (q) params.set("q", q);
        if (start) params.set("start_date", start);
        if (end) params.set("end_date", end);

        window.location.href = `${window.location.pathname}?${params.toString()}`;
    }

    // Debounce input
    form.querySelector("input[name='q']").addEventListener("input", () => {
        clearTimeout(typingTimer);
        typingTimer = setTimeout(updateFilter, typingDelay);
    });

    // Tipe dan tanggal masih langsung trigger
    form.querySelector("select[name='type']").addEventListener("change", updateFilter);
    form.querySelector("input[name='start_date']").addEventListener("change", updateFilter);
    form.querySelector("input[name='end_date']").addEventListener("change", updateFilter);
</script>


{% endblock %}